<odoo>
  <data>
      <record id="sale_action_quotations_new_rma" model="ir.actions.act_window">
            <field name="name">Quotation</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">form,tree,graph</field>
            <!--<field name="domain">[('opportunity_id', '=', 1 )]</field>-->
            <field name="context">{}</field>
      </record>



      <record id="purchase_action_quotations_new_rma" model="ir.actions.act_window">
            <field name="name">Quotation</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">form,tree,graph</field>
            <!--<field name="domain">[('opportunity_id', '=', opportunity_id)]</field>-->
            <field name="context">{}</field>
        </record>


  <record model="ir.ui.view" id="optecha_rma_form">
            <field name="name">rma_form_view</field>
            <field name="model">optecha.rma</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Workflow record">
                    <!--The header tag is built to add buttons within. This puts them at the top-->
                    <header>
                        <field name="state" widget="statusbar"/>
                    <button string="Contact Manufacturer" type="object"
                                name="contact_manufacturer" attrs="{'invisible': [('state', '!=', 'fixtures')]}"/>

                    <button string="Quote To Customer" type="object"
                                name="quote_to_customer" attrs="{'invisible': [('state', '!=', 'contact_manufacturer')]}"/>


                    <button string="Customer Issue Po" type="object"
                            name="customer_issue_po"
                            attrs="{'invisible': [('state','!=','quote_to_customer')]}"/>
                    <button string="Issue Po To Manufacture" type="object"
                            name="issue_po_to_manufacture"
                            attrs="{'invisible': [('state','!=','customer_issue_po')]}"/>

                    <button string="Customer Receives Product" type="object"
                            name="customer_receive_product"
                            attrs="{'invisible': [('state','!=','issue_po_to_manufacture')]}"/>

                    <button string="Return Fixture For Inspection" type="object"
                            name="return_fixture"
                            attrs="{'invisible': [('state','!=','customer_receive_product')]}"/>

                    <button string="Manufacturer Approval" type="object"
                            name="manufacturer_approval" attrs="{'invisible': [('state', '!=', 'return_fixture')]}"/>

                    <button string="Issue Credit To Customer" type="object"
                                name="issue_credit_to_customer"
                                attrs="{'invisible': [('state', '!=', 'manufacturer_approval'),]}"/>

                    <button string="Issue Invoice To Customer" type="object"
                                name="issue_invoice_to_customer"
                                attrs="{'invisible': [('state', '!=', 'manufacturer_approval'),]}"/>


                    <button name="done" string="Done" type="object"
                            attrs="{'invisible': ['|',('state','!=','issue_invoice_to_customer'),('state','!=','issue_credit_to_customer')]}"/>

                    <button string="Back" type="object"
                                name="back" attrs="{'invisible': ['|',('state', '=', 'done'),('state', '=', 'fixtures')]}"/>

                    <button string="RMA P.O" name="%(purchase_action_quotations_new_rma)d" type="action" class="oe_highlight"
                        context="{'search_default_partner_id': partner_id,
                                  'default_partner_id': partner_id,
                                  'search_default_opportunity_id': opportunity_id,
                                   'default_opportunity_id': opportunity_id}"
                     attrs="{'invisible': [('state','!=','issue_po_to_manufacture')]}"/>

                    <button string="RMA Quotation" name="%(sale_action_quotations_new_rma)d" type="action" class="oe_highlight"
                        context="{'search_default_partner_id': partner_id,
                                  'default_partner_id': partner_id,
                                  'search_default_opportunity_id': opportunity_id,
                                   'default_opportunity_id': opportunity_id,
                                   'default_tag_ids' : 1
                                   }"
                        attrs="{'invisible': [('state','!=','quote_to_customer')]}"/>


                    </header>
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>

                            <h1><field name="name" placeholder="e.g. RMA -xxx" /></h1>
                        </div>

                        <group>

                           <group>


                                <field name="opportunity_id" options="{ 'no_create_edit': True}"/>
                                <field name="partner_id" options="{ 'no_create_edit': True}"  />
                           </group>
                           <group>
                                <field name="orders" options="{ 'no_create_edit': True}"  />


                                <field name="team_id"/>
                                <field name="user_id"/>
                                <field name="shipping_ref"/>
                            </group>
                        </group>
                        <group>

                            <field name="reason"/>
                        </group>
                        <notebook>
                            <page name="order_lines" string="Order Lines">
                                <group>
                                    <field name="order_lines_ids">
                                        <tree editable="True" create="false">
                                            <field name="name"/>
                                            <field name="deliver_qty"/>
                                            <field name="return_qty"/>
                                            <field name="product_uom"/>
                                            <field name="select"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                            <page name="quotation" string="Quotation">
                                <group>
                                    <field name="quotation_id"/>
                                </group>
                            </page>
                            <page name="purchase" string="PO">
                                <group>
                                    <field name="po_order"/>
                                </group>
                            </page>
                        </notebook>

                    </sheet>
                     <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>-->
                        <field name="message_ids" widget="mail_thread" options="{'post_refresh': 'recipients'}"/>
                     </div>

                </form>
            </field>
    </record>

    <record model="ir.ui.view" id="optecha_rma_tree">
            <field name="name">rma_tree_view</field>
            <field name="model">optecha.rma</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <tree string="tree view">
                    <field name="name"/>
                    <field name="opportunity_id"/>
                    <field name="orders"/>
                    <field name="order_lines"/>
                    <field name="reason"/>
                    <field name="partner_id"/>
                    <field name="product_id"/>
                    <field name="quantity"/>
                </tree>
            </field>
    </record>

    <record model="ir.actions.act_window" id="rma_form_action">
            <field name="name">Optecha RMA</field>
            <field name="res_model">optecha.rma</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
    </record>


    <menuitem id="menu_optecha_rma"
                  name="RMA"
                  action="rma_form_action" parent="crm.crm_menu_pipeline"
                  sequence="70"/>


  </data>
</odoo>